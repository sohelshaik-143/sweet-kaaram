<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sweet & Karam üç¨</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
</head>
<body class="bg-gradient-to-br from-yellow-100 via-pink-100 to-red-100 font-sans">

  <!-- Header -->
  <header class="bg-red-700 text-white p-6 text-center shadow-lg animate__animated animate__fadeInDown">
    <h1 class="text-4xl font-bold mb-2">üç¨ Sweet & Karam üçó</h1>
    <p class="text-lg">Fresh & Hygienic Food Items ‚Äî Made With Love</p>
    <p class="mt-2">üìû Contacts: 9959655339, 6304614764, 8220041877</p>
    <p>üí∞ Payment: Cash on Delivery only</p>
  </header>

  <main class="container mx-auto my-10 px-4">

    <!-- Menu Section -->
    <section class="menu mb-16">
      <h2 class="text-3xl font-semibold text-center mb-6 animate__animated animate__fadeInUp">Our Menu</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">

        <!-- Item 1 -->
        <div class="item bg-white rounded-xl shadow-lg p-4 flex flex-col items-center transform hover:scale-105 transition duration-300 animate__animated animate__zoomIn" data-name="Chicken Pickle 100g" data-price="99">
          <h3 class="text-lg font-semibold mb-1 text-center">Chicken Pickle (100 g)</h3>
          <p class="text-red-600 font-bold mb-2">‚Çπ99</p>
          <input type="number" min="0" value="0" class="qty border rounded px-2 py-1 w-20 text-center">
        </div>

        <!-- Item 2 -->
        <div class="item bg-white rounded-xl shadow-lg p-4 flex flex-col items-center transform hover:scale-105 transition duration-300 animate__animated animate__zoomIn" data-name="Chicken Pickle 250g" data-price="199">
          <h3 class="text-lg font-semibold mb-1 text-center">Chicken Pickle (250 g)</h3>
          <p class="text-red-600 font-bold mb-2">‚Çπ199</p>
          <input type="number" min="0" value="0" class="qty border rounded px-2 py-1 w-20 text-center">
        </div>

        <!-- Item 3 -->
        <div class="item bg-white rounded-xl shadow-lg p-4 flex flex-col items-center transform hover:scale-105 transition duration-300 animate__animated animate__zoomIn" data-name="Gulabjamun (Box of 6)" data-price="30">
          <h3 class="text-lg font-semibold mb-1 text-center">Gulabjamun (Box of 6)</h3>
          <p class="text-red-600 font-bold mb-2">‚Çπ30</p>
          <input type="number" min="0" value="0" class="qty border rounded px-2 py-1 w-20 text-center">
        </div>

        <!-- Item 4 -->
        <div class="item bg-white rounded-xl shadow-lg p-4 flex flex-col items-center transform hover:scale-105 transition duration-300 animate__animated animate__zoomIn" data-name="Black Nuvvula Laddu (Box of 6)" data-price="30">
          <h3 class="text-lg font-semibold mb-1 text-center">Black Nuvvula Laddu (Box of 6)</h3>
          <p class="text-red-600 font-bold mb-2">‚Çπ30</p>
          <input type="number" min="0" value="0" class="qty border rounded px-2 py-1 w-20 text-center">
        </div>

        <!-- Item 5 -->
        <div class="item bg-white rounded-xl shadow-lg p-4 flex flex-col items-center transform hover:scale-105 transition duration-300 animate__animated animate__zoomIn" data-name="Murukulu 150g" data-price="50">
          <h3 class="text-lg font-semibold mb-1 text-center">Murukulu 150 g</h3>
          <p class="text-red-600 font-bold mb-2">‚Çπ50</p>
          <input type="number" min="0" value="0" class="qty border rounded px-2 py-1 w-20 text-center">
        </div>

      </div>
    </section>

    <!-- Order Form -->
    <section class="order mb-16 bg-white p-6 rounded-xl shadow-lg animate__animated animate__fadeInUp">
      <h2 class="text-3xl font-semibold text-center mb-4">Place Order</h2>
      <form id="orderForm" class="flex flex-col gap-4 max-w-md mx-auto">
        <input type="text" name="name" placeholder="Your Name" required class="border rounded px-3 py-2">
        <input type="text" name="phone" placeholder="Phone" required class="border rounded px-3 py-2">
        <input type="text" name="address" placeholder="Full Address" required class="border rounded px-3 py-2">
        <div class="text-center font-bold text-xl">Total: ‚Çπ<span id="total">0</span></div>
        <button type="submit" class="bg-red-700 text-white py-3 rounded-xl hover:bg-red-800 transition duration-300">Place Order (COD)</button>
      </form>
      <div id="orderResult" class="text-center mt-4 font-semibold text-green-700"></div>
    </section>

    <!-- Track Order Section -->
    <section class="track mb-16 bg-white p-6 rounded-xl shadow-lg animate__animated animate__fadeInUp">
      <h2 class="text-3xl font-semibold text-center mb-4">Track Your Order</h2>
      <form id="trackForm" class="flex flex-col gap-4 max-w-md mx-auto">
        <input type="text" id="trackingIdInput" placeholder="Enter Tracking ID" required class="border rounded px-3 py-2">
        <button type="submit" class="bg-blue-600 text-white py-3 rounded-xl hover:bg-blue-700 transition duration-300">Track Order</button>
      </form>
      <div id="trackResult" class="text-center mt-4 font-semibold text-purple-700"></div>
    </section>

    <!-- Order History -->
    <section class="history mb-16 bg-white p-6 rounded-xl shadow-lg animate__animated animate__fadeInUp">
      <h2 class="text-3xl font-semibold text-center mb-4">Order History</h2>
      <button id="loadHistoryBtn" class="bg-green-600 text-white py-2 px-4 rounded-xl mb-4 hover:bg-green-700 transition duration-300">Load Order History</button>
      <div id="orderHistory" class="flex flex-col gap-4 max-w-3xl mx-auto"></div>
    </section>

  </main>

  <footer class="text-center p-4 mt-10 bg-red-700 text-white">
    ¬© 2025 Sweet & Karam. All Rights Reserved.
  </footer>

  <script>
    const items = document.querySelectorAll('.item');
    const totalElement = document.getElementById('total');
    const form = document.getElementById('orderForm');
    const result = document.getElementById('orderResult');
    const historyContainer = document.getElementById('orderHistory');
    const trackForm = document.getElementById('trackForm');
    const trackResult = document.getElementById('trackResult');
    const loadHistoryBtn = document.getElementById('loadHistoryBtn');

    items.forEach(item => item.querySelector('.qty').addEventListener('input', updateTotal));
    function updateTotal() {
      let total = 0;
      items.forEach(item => {
        const price = parseFloat(item.dataset.price);
        const qty = parseInt(item.querySelector('.qty').value) || 0;
        total += price * qty;
      });
      totalElement.textContent = total;
    }

    // Place order
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = form.name.value;
      const phone = form.phone.value;
      const address = form.address.value;

      const orderItems = [];
      items.forEach(item => {
        const qty = parseInt(item.querySelector('.qty').value);
        if (qty > 0) orderItems.push({ item: item.dataset.name, price: item.dataset.price, qty });
      });

      if (orderItems.length === 0) {
        alert('Please select at least one item.');
        return;
      }

      const response = await fetch('/order', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, phone, address, items: orderItems })
      });

      const data = await response.json();
      if (response.ok) {
        result.textContent = `‚úÖ Order Placed! Tracking ID: ${data.trackingId}`;
        form.reset();
        updateTotal();
      } else {
        result.textContent = `‚ùå ${data.error || 'Something went wrong.'}`;
      }
    });

    // Track order
    trackForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const trackingId = document.getElementById('trackingIdInput').value.trim();
      if (!trackingId) return alert('Please enter a Tracking ID.');

      try {
        const res = await fetch(`/track/${trackingId}`);
        const data = await res.json();
        if (res.ok) {
          trackResult.innerHTML = `
            <div class="border rounded p-3 shadow-sm bg-yellow-50">
              <div><strong>Tracking ID:</strong> ${data.trackingId}</div>
              <div><strong>Status:</strong> <span class="${
                data.status === 'Delivered' ? 'text-green-600' :
                data.status === 'Out for Delivery' ? 'text-blue-600' : 'text-yellow-600'}">
                ${data.status}</span></div>
              <div><strong>Date:</strong> ${data.timestamp}</div>
              <div><strong>Total:</strong> ‚Çπ${data.total}</div>
            </div>
          `;
        } else {
          trackResult.textContent = `‚ùå ${data.error || 'Tracking ID not found.'}`;
        }
      } catch (err) {
        console.error('‚ùå Error tracking order:', err);
        trackResult.textContent = '‚ùå Something went wrong while tracking your order.';
      }
    });

    // Load order history manually
    loadHistoryBtn.addEventListener('click', async () => {
      try {
        const res = await fetch('/api/orders');
        const orders = await res.json();
        historyContainer.innerHTML = orders.slice().reverse().map(o => `
          <div class="border rounded p-3 shadow-sm bg-yellow-50">
            <div><strong>ID:</strong> ${o['S.No']}</div>
            <div><strong>Name:</strong> ${o['Name']}</div>
            <div><strong>Phone:</strong> ${o['Ph no']}</div>
            <div><strong>Item:</strong> ${o['Item']}</div>
            <div><strong>Quantity:</strong> ${o['Quantity']}</div>
            <div><strong>Total:</strong> ‚Çπ${o['Amount']}</div>
            <div><strong>Tracking ID:</strong> <code>${o['Tracking ID']}</code></div>
            <div><strong>Status:</strong> <span class="${
              o['Order Status']==='Delivered'?'text-green-600':
              o['Order Status']==='Out for Delivery'?'text-blue-600':'text-yellow-600'}">
              ${o['Order Status']}</span></div>
            <div><strong>Date:</strong> ${o['Date']}</div>
          </div>
        `).join('');
      } catch (err) {
        console.error('‚ùå Failed to load orders:', err);
        historyContainer.innerHTML = `<div class="text-red-600 font-bold text-center">Failed to load orders.</div>`;
      }
    });
  </script>
</body>
</html>
