<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sweet & Karam üç¨</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
</head>

<body class="bg-gradient-to-br from-yellow-100 via-pink-100 to-red-100 font-sans">

  <!-- Header -->
  <header class="bg-red-700 text-white p-6 text-center shadow-lg animate__animated animate__fadeInDown">
    <h1 class="text-4xl font-bold mb-2">üç¨ Sweet & Karam üçó</h1>
    <p class="text-lg">Fresh & Hygienic Food Items ‚Äî Made With Love</p>
    <p class="mt-2">üìû Contacts: 9959655339, 6304614764, 8220041877</p>
    <p>üí∞ Payment: Cash on Delivery only</p>
  </header>

  <main class="container mx-auto my-10 px-4">

    <!-- Menu Section -->
    <section class="menu mb-16">
      <h2 class="text-3xl font-semibold text-center mb-6 animate__animated animate__fadeInUp">Our Menu</h2>

      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">

        <!-- Updated item card -->
        <div class="item menu-item bg-white rounded-xl shadow-lg p-4 flex flex-col items-center"
             data-price="99">
          <h3 class="item-name text-lg font-semibold mb-1 text-center">Chicken Pickle (100 g)</h3>
          <p class="item-price text-red-600 font-bold mb-2" data-price="99">‚Çπ99</p>
          <input type="number" min="0" value="0" class="qty-input qty border rounded px-2 py-1 w-20 text-center" />
        </div>

        <div class="item menu-item bg-white rounded-xl shadow-lg p-4 flex flex-col items-center"
             data-price="199">
          <h3 class="item-name text-lg font-semibold mb-1 text-center">Chicken Pickle (250 g)</h3>
          <p class="item-price text-red-600 font-bold mb-2" data-price="199">‚Çπ199</p>
          <input type="number" min="0" value="0" class="qty-input qty border rounded px-2 py-1 w-20 text-center" />
        </div>

        <div class="item menu-item bg-white rounded-xl shadow-lg p-4 flex flex-col items-center"
             data-price="30">
          <h3 class="item-name text-lg font-semibold mb-1 text-center">Gulabjamun (Box of 6)</h3>
          <p class="item-price text-red-600 font-bold mb-2" data-price="30">‚Çπ30</p>
          <input type="number" min="0" value="0" class="qty-input qty border rounded px-2 py-1 w-20 text-center" />
        </div>

        <div class="item menu-item bg-white rounded-xl shadow-lg p-4 flex flex-col items-center"
             data-price="30">
          <h3 class="item-name text-lg font-semibold mb-1 text-center">Black Nuvvula Laddu (Box of 6)</h3>
          <p class="item-price text-red-600 font-bold mb-2" data-price="30">‚Çπ30</p>
          <input type="number" min="0" value="0" class="qty-input qty border rounded px-2 py-1 w-20 text-center" />
        </div>

        <div class="item menu-item bg-white rounded-xl shadow-lg p-4 flex flex-col items-center"
             data-price="50">
          <h3 class="item-name text-lg font-semibold mb-1 text-center">Murukulu 150 g</h3>
          <p class="item-price text-red-600 font-bold mb-2" data-price="50">‚Çπ50</p>
          <input type="number" min="0" value="0" class="qty-input qty border rounded px-2 py-1 w-20 text-center" />
        </div>

      </div>
    </section>

    <!-- Order Form -->
    <section class="order mb-16 bg-white p-6 rounded-xl shadow-lg animate__animated animate__fadeInUp">
      <h2 class="text-3xl font-semibold text-center mb-4">Place Order</h2>
      <form id="orderForm" class="flex flex-col gap-4 max-w-md mx-auto">
        <input type="text" name="name" placeholder="Your Name" required class="border rounded px-3 py-2">
        <input type="text" name="phone" placeholder="Phone" required class="border rounded px-3 py-2">
        <input type="text" name="address" placeholder="Full Address" required class="border rounded px-3 py-2">
        <div class="text-center font-bold text-xl">Total: ‚Çπ<span id="total">0</span></div>
        <button type="submit" class="bg-red-700 text-white py-3 rounded-xl">Place Order (COD)</button>
      </form>
      <div id="orderResult" class="text-center mt-4 font-semibold text-green-700"></div>
    </section>

    <!-- Track Order Section -->
    <section class="track mb-16 bg-white p-6 rounded-xl shadow-lg animate__animated animate__fadeInUp">
      <h2 class="text-3xl font-semibold text-center mb-4">Track Your Order</h2>
      <form id="trackForm" class="flex flex-col gap-4 max-w-md mx-auto">
        <input type="text" id="trackingIdInput" placeholder="Enter Tracking ID" required class="border rounded px-3 py-2">
        <button type="submit" class="bg-blue-600 text-white py-3 rounded-xl">Track Order</button>
      </form>
      <div id="trackResult" class="text-center mt-4 font-semibold text-purple-700"></div>
    </section>

    <!-- Order History -->
    <section class="history mb-16 bg-white p-6 rounded-xl shadow-lg animate__animated animate__fadeInUp">
      <h2 class="text-3xl font-semibold text-center mb-4">Order History</h2>
      <button id="loadHistoryBtn" class="bg-green-600 text-white py-2 px-4 rounded-xl">Load Order History</button>
      <div id="orderHistory" class="flex flex-col gap-4 max-w-3xl mx-auto"></div>
    </section>

  </main>

  <footer class="text-center p-4 mt-10 bg-red-700 text-white">
    ¬© 2025 Sweet & Karam. All Rights Reserved.
  </footer>

<script>
/* ========== TOTAL CALCULATION ========== */
const items = document.querySelectorAll('.menu-item');
const totalElement = document.getElementById('total');

items.forEach(item =>
  item.querySelector('.qty-input').addEventListener('input', updateTotal)
);

function updateTotal() {
  let total = 0;
  items.forEach(item => {
    const qty = Number(item.querySelector('.qty-input').value) || 0;
    const price = Number(item.dataset.price);
    total += price * qty;
  });
  totalElement.textContent = total;
}

/* ========== PLACE ORDER (FIXED) ========== */
document.getElementById('orderForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  const orderItems = [];

  items.forEach(item => {
    const qty = Number(item.querySelector('.qty-input').value);
    if (qty > 0) {
      orderItems.push({
        name: item.querySelector('.item-name').innerText,
        price: Number(item.dataset.price),
        qty
      });
    }
  });

  if (orderItems.length === 0) {
    alert('Please select at least one item.');
    return;
  }

  const res = await fetch('/order', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      name: orderForm.name.value,
      phone: orderForm.phone.value,
      address: orderForm.address.value,
      items: orderItems
    })
  });

  const data = await res.json();

  // FIXED: backend returns orderId, not trackingId
  document.getElementById("orderResult").innerHTML =
    `‚úÖ Order Placed! Tracking ID: <b>${data.orderId}</b>`;

  orderForm.reset();
  updateTotal();
});

/* TRACK ORDER ‚Äî unchanged */
</script>

</body>
</html>
